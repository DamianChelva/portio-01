name: Port Trigger Test

on:
 workflow_dispatch:
    inputs:
      message:
        description: "Message from Port"
        required: false
        default: "Hello from Port"
      port_context:
        description: "Context from Port (JSON string)"
        required: false

jobs:
   run:
    runs-on: ubuntu-latest
    steps:
      - run: echo "${{ github.event.inputs.message }}"
      - run: echo '${{ github.event.inputs.port_context }}'

      - name: Report SUCCESS back to Port
        if: success()
        run: |
          curl -sS -X PATCH \
            -H "Authorization: Bearer ${{ secrets.PORT_API_TOKEN }}" \
            -H "Content-Type: application/json" \
            "https://api.getport.io/v1/actions/runs/${{ steps.portctx.outputs.runId }}" \
            -d '{"status":"SUCCESS","message":"Workflow completed successfully"}'

      - name: Report FAILURE back to Port
        if: failure()
        run: |
          curl -sS -X PATCH \
            -H "Authorization: Bearer ${{ secrets.PORT_API_TOKEN }}" \
            -H "Content-Type: application/json" \
            "https://api.getport.io/v1/actions/runs/${{ steps.portctx.outputs.runId }}" \
            -d '{"status":"FAILURE","message":"Workflow failed"}'
